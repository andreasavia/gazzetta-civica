---
import Base from '../layouts/Base.astro';
import HomeSearch from '../components/HomeSearch.astro';
import { getCollection } from 'astro:content';

const articles = await getCollection('articoli', ({ data }) => !data.draft);
const sortedArticles = articles.sort((a, b) => b.data.publishedDate.valueOf() - a.data.publishedDate.valueOf());
---

<Base
  title="Home"
  description="Un archivio aperto della legislazione italiana. Raccogliamo, organizziamo e rendiamo accessibili le leggi e i decreti pubblicati in Gazzetta Ufficiale."
>
  <div class="hero-wrapper">
    <section class="hero">
      <h1>Gazzetta Civica</h1>
      <p class="tagline">Trasparenza legislativa per una cittadinanza informata</p>
      <div class="intro">
        <p>
          Un archivio aperto della legislazione italiana.
          Raccogliamo, organizziamo e rendiamo accessibili le leggi e i decreti
          pubblicati in Gazzetta Ufficiale.
        </p>
      </div>
      <HomeSearch />
    </section>
  </div>

  <section class="content-section" id="articoli">
    <h2>Ultimi Aggiornamenti</h2>
    {sortedArticles.length === 0 ? (
      <p class="empty-state">
        Nessun articolo pubblicato ancora.
      </p>
    ) : (
      <ul class="article-list">
        {sortedArticles.map((article) => (
          <li class="article-item">
            <a href={`/gazzetta-civica/articoli/${article.data.publishedDate.getFullYear()}/${article.data.urlSlug}/`}>
              <span class="article-date">
                {article.data.publishedDate.toLocaleDateString('it-IT', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric'
                })}
              </span>
              <h3>{article.data.title}</h3>
              {(article.data.excerpt || article.data.subtitle) && (
                <p class="article-excerpt">{article.data.excerpt || article.data.subtitle}</p>
              )}
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</Base>
